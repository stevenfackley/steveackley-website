# =============================================================================
# Caddyfile — EC2 Reverse Proxy (inside Docker, managed by server/docker-compose.yml)
#
# IMPORTANT: The `http://` scheme prefix is REQUIRED here.
# Without it, Caddy automatically redirects HTTP → HTTPS (308) on port 80.
# Since Cloudflare (Flexible SSL) connects to origin on port 80, that redirect
# creates an infinite loop: Cloudflare → origin 308 → Cloudflare → origin 308 …
#
# Cloudflare terminates TLS for the visitor. Caddy only needs to speak HTTP
# to the Cloudflare edge — `http://` prevents Caddy's auto-HTTPS behavior.
# =============================================================================

# ── Personal site ─────────────────────────────────────────────────────────────
http://aws.steveackley.org {
    reverse_proxy steveackley-web:3000
}

# Once you point steveackley.org DNS to this EC2 IP, uncomment:
# http://steveackley.org, http://www.steveackley.org {
#     reverse_proxy steveackley-web:3000
# }

# ── P1 Ops Hub — Test ─────────────────────────────────────────────────────────
# Uncomment and set the correct domain when ready:
# http://p1ops-test.example.com {
#     reverse_proxy p1ops-test-web:3000
# }

# ── P1 Ops Hub — Production ───────────────────────────────────────────────────
# Uncomment and set the correct domain when ready:
# http://p1opshub.com, http://www.p1opshub.com {
#     reverse_proxy p1ops-prod-web:3000
# }
